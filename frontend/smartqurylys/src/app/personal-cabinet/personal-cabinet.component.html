<header></header> <!-- Header will be rendered here -->
<div class="personal-cabinet">
  <h1>–õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢</h1>

  <div *ngIf="loadingUser || loadingProjects" class="loading-message">
    –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <ng-container *ngIf="user && !loadingUser">
    <div class="customer-info">
      <h2>–ó–ê–ö–ê–ó–ß–ò–ö</h2>
      <div class="info-item">
        <strong>–ü–æ–ª–Ω–æ–µ –∏–º—è:</strong> {{ user.fullName }}
      </div>
      <div *ngIf="isOrganisationUser && user.organization" class="info-item">
        <strong>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:</strong> {{ user.organization }}
      </div>
      <div class="info-item">
        <strong>–ò–ò–ù/–ë–ò–ù:</strong> {{ user.iinBin }}
      </div>
      <div class="info-item">
        <strong>–¢–µ–ª:</strong> {{ user.phone }}
      </div>
      <div class="info-item">
        <strong>E-mail:</strong> {{ user.email }}
      </div>
      <div class="info-item">
        <strong>–ì–æ—Ä–æ–¥:</strong> {{ user.city }}
      </div>
      <div *ngIf="isOrganisationUser" class="info-item status-toggle-item">
        <strong>–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:</strong>
        <button [class]="'status-btn ' + (isUpdatingStatus ? 'loading' : '')" (click)="toggleAvailability()"
          [disabled]="isUpdatingStatus">
          {{ isUpdatingStatus ? '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...' : '–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å' }}
        </button>
      </div>
      <button class="edit-profile-btn" (click)="openEditModal()">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
      <button class="edit-profile-btn" (click)="openEditEmailModal()">–ò–∑–º–µ–Ω–∏—Ç—å Email</button>
      <button class="edit-profile-btn" (click)="openEditPasswordModal()">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
    </div>

    <hr>
  </ng-container>

  <app-user-profile-edit-modal *ngIf="showEditProfileModal" [user]="user" (close)="closeEditProfileModal()"
    (userUpdated)="onUserUpdated($event)">
  </app-user-profile-edit-modal>

  <app-organisation-profile-edit-modal *ngIf="showEditOrganisationProfileModal" [organisation]="organisationToEdit"
    (close)="closeEditOrganisationProfileModal()" (organisationUpdated)="onOrganisationUpdated($event)">
  </app-organisation-profile-edit-modal>

  <app-user-email-edit-modal *ngIf="showEditEmailModal" [user]="user" (close)="closeEditEmailModal()"
    (emailUpdated)="onEmailUpdated($event)">
  </app-user-email-edit-modal>

  <app-user-password-edit-modal *ngIf="showEditPasswordModal" [user]="user" (close)="closeEditPasswordModal()"
    (passwordUpdated)="onPasswordUpdated()">
  </app-user-password-edit-modal>

  <div class="projects-section">
    <h3>–ü—Ä–æ–µ–∫—Ç—ã</h3>

    <div *ngIf="projects.length === 0 && !loadingProjects" class="no-projects-message">
      –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤.
    </div>

    <div class="project-card" *ngFor="let project of projects">
      <div class="project-name">{{ project.name }}</div>

      <div class="project-timer">
        <span class="timer-label">–î–æ –∫–æ–Ω—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞</span>
        <div *ngIf="project.timeRemaining">
          <ng-container *ngIf="!project.timeRemaining.isExpired">
            <span class="timer-value">{{ project.timeRemaining.days }}</span>
            <span class="timer-units">–¥–Ω–µ–π</span>
            <span class="timer-value">{{ project.timeRemaining.hours }}</span>
            <span class="timer-units">—á–∞—Å–æ–≤</span>
          </ng-container>
          <ng-container *ngIf="project.timeRemaining.isExpired">
            <span class="timer-value">–°—Ä–æ–∫ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è</span>
            <span class="timer-units">{{ project.timeRemaining.expiredDate }}</span>
          </ng-container>
        </div>
      </div>

      <button class="open-btn" (click)="openProject(project.id)">–û—Ç–∫—Ä—ã—Ç—å</button>
    </div>

    <div class="divider"></div>

    <div class="add-project">
      <button class="add-project-btn" (click)="addNewProject()">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</button>
      <p class="note">–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–∞–±–æ—á–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞</p>
    </div>
  </div>

  <!-- –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π -->
  <div *ngIf="isOrganisationUser" class="licenses-section">
    <hr>
    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏</h3>

    <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–π –ª–∏—Ü–µ–Ω–∑–∏–∏ -->
    <!-- <div class="license-upload-card">
      <h4>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ª–∏—Ü–µ–Ω–∑–∏—é</h4>
      <div class="license-form">
        <div class="form-group">
          <label for="newLicenseFile">–§–∞–π–ª –ª–∏—Ü–µ–Ω–∑–∏–∏</label>
          <input type="file" id="newLicenseFile" (change)="onLicenseFileSelected($event)" class="file-input">
        </div>
        <div class="form-group">
          <label for="newLicenseCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
          <input type="text" id="newLicenseCategory" [(ngModel)]="newLicenseCategory"
            placeholder="–ù–∞–ø—Ä: –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è" class="text-input">
        </div>
        <button [disabled]="!selectedLicenseFile || isUploadingLicense" (click)="addLicense()" class="add-license-btn">
          {{ isUploadingLicense ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–î–æ–±–∞–≤–∏—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é' }}
        </button>
      </div>
    </div> -->

    <!-- –°–ø–∏—Å–æ–∫ –ª–∏—Ü–µ–Ω–∑–∏–π -->
    <div class="licenses-list">
      <div *ngIf="loadingLicenses" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–π...</div>

      <div *ngFor="let license of licenses" class="license-item">
        <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div *ngIf="editingLicenseId === license.id" class="edit-license-form">
          <h4>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {{ license.name }}</h4>
          <div class="form-group">
            <label>–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <input type="text" [(ngModel)]="editLicenseName" class="text-input">
          </div>
          <div class="form-group">
            <label>–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <input type="text" [(ngModel)]="editLicenseCategory" class="text-input">
          </div>
          <div class="form-group">
            <label>–û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <input type="file" (change)="onEditLicenseFileSelected($event)" class="file-input">
          </div>
          <div class="edit-actions">
            <button class="save-btn" (click)="updateLicense()" [disabled]="isUploadingLicense">
              {{ isUploadingLicense ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' }}
            </button>
            <button class="cancel-btn" (click)="cancelEditingLicense()" [disabled]="isUploadingLicense">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>

        <!-- –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
        <div *ngIf="editingLicenseId !== license.id" class="license-info">
          <div class="license-header">
            <span class="license-name">{{ license.name }}</span>
            <span [class]="'status-badge ' + getStatusBadgeClass(license.reviewStatus)">
              {{ getStatusText(license.reviewStatus) }}
            </span>
          </div>
          <div class="license-details">
            <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ license.licenseCategoryDisplay || '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}</p>
            <p><strong>–î–∞—Ç–∞:</strong> {{ license.createdAt | date:'dd.MM.yyyy' }}</p>
            <p *ngIf="license.rejectionReason" class="rejection-reason">
              <strong>–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:</strong> {{ license.rejectionReason }}
            </p>
          </div>
          <div class="license-actions">
            <button (click)="downloadLicense(license)" class="icon-btn" title="–°–∫–∞—á–∞—Ç—å">üì• –°–∫–∞—á–∞—Ç—å</button>
            <button (click)="startEditingLicense(license)" class="icon-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>